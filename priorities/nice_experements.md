# –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ –≤ non-RT-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞—Ö

*–î–ª—è –ª–∞–∫–æ–Ω–∏—á–Ω–æ—Å—Ç–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã —Å–æ–∫—Ä–∞—â—ë–Ω–Ω—ã–µ –ª–æ–≥–∏ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞, –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ [nice_experement.log](./priorities/nice_experement.log).*

### –û–±—â–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
–î–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞–±–æ—Ç—ã –ø–æ–ª–∏—Ç–∏–∫ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (SCHED_RR –∏ SCHED_FIFO) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å —Å–ª–µ–¥—É—é—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º CPU –¥–æ 1 —è–¥—Ä–∞ (—Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞: [`container.sh`](./priorities/container.sh))
- –°–∫—Ä–∏–ø—Ç [`spin.sh`](./priorities/spin.sh) —Å busy-loop –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ CPU-bound –∑–∞–¥–∞—á
- –£—Ç–∏–ª–∏—Ç—ã `nice`, `renice` –∏ `top` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –°—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–∞–±–ª—é–¥–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã, –¥–∞–ª–µ–µ –≤ –≤—ã–≤–æ–¥–µ top –æ–Ω–∏ –±—É–¥—É—Ç –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:
```
‚ûú  priorities sudo ./container.sh
[root@ca900302a985 /]# cd src/

    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
      1 root      20   0   11844   2944   2560 S   0.0  0.0   0:00.01 bash
     15 root      20   0   56068   3768   3384 R   0.0  0.0   0:00.00 top
``` 

### –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 1: –û–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π CFS
–ó–∞–ø—É—Å–∫–∞–µ–º 1 —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ spin.sh:
``` 
[root@ca900302a985 src]# ./spin.sh &

    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
     16 root      20   0   11704   2580   2452 R 100.0  0.0   0:02.45 spin.sh
```
CFS –æ—Ç–¥–∞–µ—Ç –µ–º—É ~100% CPU.

### –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 2: –ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Å –ø–æ–ª–∏—Ç–∏–∫–æ–π CFS
–ó–∞–ø—É—Å–∫–∞–µ–º –µ—â—ë 3 —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ spin.sh:
```
[root@ca900302a985 src]# ./spin.sh & ./spin.sh & ./spin.sh &

    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
     16 root      20   0   11704   2580   2452 R  25.0  0.0   2:34.53 spin.sh
     18 root      20   0   11704   2568   2440 R  25.0  0.0   0:15.20 spin.sh
     19 root      20   0   11704   2624   2496 R  25.0  0.0   0:15.20 spin.sh
     20 root      20   0   11704   2568   2440 R  25.0  0.0   0:15.20 spin.sh
```
–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ ~25% CPU

### –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 3: –í–ª–∏—è–Ω–∏–µ nice –Ω–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ CPU
–ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã —Å —Ä–∞–∑–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ nice:
```
[root@ca900302a985 src]# nice -n 2 ./spin.sh &
[root@ca900302a985 src]# nice -n 4 ./spin.sh &
[root@ca900302a985 src]# nice -n 6 ./spin.sh &
[root@ca900302a985 src]# nice -n -2 ./spin.sh &

    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
     46 root      18  -2   11704   2468   2340 R  53.3  0.0   0:14.04 spin.sh
     43 root      22   2   11704   2480   2352 R  20.0  0.0   0:10.27 spin.sh
     44 root      24   4   11704   2568   2440 R  20.0  0.0   0:05.41 spin.sh
     45 root      26   6   11704   2572   2444 R  13.3  0.0   0:02.74 spin.sh
```
–ù–∞–±–ª—é–¥–∞–µ—Ç—Å—è —è–≤–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å: –ø—Ä–æ—Ü–µ—Å—Å —Å nice=-2 (–Ω–∞–∏–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç) –ø–æ–ª—É—á–∞–µ—Ç ~53% CPU, —Ç–æ–≥–¥–∞ –∫–∞–∫ –ø—Ä–æ—Ü–µ—Å—Å —Å nice=6 (–Ω–∞–∏–Ω–∏–∑—à–∏–π) - —Ç–æ–ª—å–∫–æ ~13%.

### –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 4: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤
–ú–µ–Ω—è–µ–º nice –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ 46:
```
[root@ca900302a985 src]# renice -n -10 -p 46

     46 root      10 -10   11704   2468   2340 R  88.2  0.0   0:46.72 spin.sh
     43 root      22   2   11704   2480   2352 R   5.9  0.0   0:20.27 spin.sh
     44 root      24   4   11704   2568   2440 R   5.9  0.0   0:11.87 spin.sh
     45 root      26   6   11704   2572   2444 R   5.9  0.0   0:06.89 spin.sh
```
–ü–æ—Å–ª–µ —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ (nice=-10) –ø—Ä–æ—Ü–µ—Å—Å 46 –ø–æ–ª—É—á–∞–µ—Ç ~88% CPU.

### –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç 5: –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤
–ü–æ–≤—ã—à–∞–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞ 45:
```
[root@ca900302a985 src]# renice -n -5 -p 45

PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND
     46 root      10 -10   11704   2468   2340 R  68.4  0.0   2:15.89 spin.sh
     45 root      15  -5   11704   2572   2444 R  21.1  0.0   0:12.05 spin.sh
     43 root      22   2   11704   2480   2352 R   5.3  0.0   0:26.39 spin.sh
     44 root      24   4   11704   2568   2440 R   5.3  0.0   0:15.82 spin.sh
```
–¢–µ–ø–µ—Ä—å –ø—Ä–æ—Ü–µ—Å—Å 45 –ø–æ–ª—É—á–∞–µ—Ç ~21% CPU, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –∑–Ω–∞—á–µ–Ω–∏—è–º nice.

üì∫–°–º. [*–≤–∏–¥–µ–æ—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç*](https://www.youtube.com/watch?v=II2M3rqgCQA) –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞.